<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Donut Market</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #05070b;
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 32px 16px;
    }

    .page {
      width: 100%;
      max-width: 1100px;
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 24px;
    }

    @media (max-width: 900px) {
      .page {
        grid-template-columns: 1fr;
      }
    }

    .products,
    .checkout {
      background: #0b0f19;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.7);
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
    }

    .product-card {
      background: #101623;
      border-radius: 12px;
      padding: 16px 12px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .product-icon {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      background: #181f2f;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .product-name {
      font-size: 14px;
      font-weight: 600;
    }

    .product-price {
      font-size: 16px;
      font-weight: 700;
      color: #f5f5f5;
    }

    .product-btn {
      margin-top: 6px;
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      background: #2563eb;
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    .product-btn:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
    }

    .product-btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    /* Checkout side */
    .checkout-columns {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 750px) {
      .checkout-columns {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      margin-bottom: 12px;
    }

    label {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
      display: block;
    }

    .required {
      color: #f97373;
    }

    input,
    textarea {
      width: 100%;
      background: #05070b;
      border-radius: 10px;
      border: 1px solid #1e293b;
      padding: 8px 10px;
      font-size: 14px;
      color: #f5f5f5;
      outline: none;
    }

    input:focus,
    textarea:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.5);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .hint {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 3px;
    }

    .cart-box {
      background: #05070b;
      border-radius: 14px;
      padding: 12px;
      border: 1px solid #111827;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 140px;
    }

    .cart-empty {
      font-size: 13px;
      color: #9ca3af;
      text-align: center;
      margin-top: 16px;
    }

    .cart-item {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 4px;
      align-items: center;
      padding: 6px 4px;
      border-bottom: 1px solid #111827;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item-name {
      font-size: 13px;
      font-weight: 500;
    }

    .cart-item-controls {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
    }

    .cart-qty-btn {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cart-qty {
      min-width: 18px;
      text-align: center;
    }

    .cart-price {
      font-size: 13px;
      color: #d1d5db;
    }

    .cart-total-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      font-weight: 600;
      margin-top: 8px;
    }

    .warning {
      margin-top: 10px;
      font-size: 12px;
      padding: 8px;
      border-radius: 10px;
      background: #1f2937;
      color: #e5e7eb;
      border-left: 3px solid #facc15;
    }

    .btn-primary {
      margin-top: 14px;
      width: 100%;
      border-radius: 999px;
      padding: 10px 16px;
      border: none;
      background: linear-gradient(90deg, #22c55e, #16a34a);
      font-weight: 700;
      font-size: 14px;
      color: #052e16;
      cursor: pointer;
      text-align: center;
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(34, 197, 94, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .footer-note {
      margin-top: 8px;
      font-size: 10px;
      color: #6b7280;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- LEFT: PRODUCTS -->
    <section class="products">
      <h2 class="section-title">Donut Market – Items</h2>
      <div class="product-grid" id="productGrid">
        <!-- Products rendered by JS -->
      </div>
    </section>

    <!-- RIGHT: CHECKOUT -->
    <section class="checkout">
      <h2 class="section-title">Checkout</h2>
      <div class="checkout-columns">
        <!-- Customer info -->
        <div>
          <div class="form-group">
            <label for="discord">Discord Username <span class="required">*</span></label>
            <input id="discord" placeholder="YourDiscordName#1234" />
          </div>

          <div class="form-group">
            <label for="minecraft">Minecraft Username <span class="required">*</span></label>
            <input id="minecraft" placeholder="YourMinecraftUsername" />
            <div class="hint">
              If you are on Bedrock, include a dot (.) in front of your name.
            </div>
          </div>

          <div class="form-group">
            <label for="notes">Additional Notes (optional)</label>
            <textarea id="notes" placeholder="Any instructions or notes..."></textarea>
          </div>

          <div class="warning">
            Orders under €0.50 may be cancelled by payment providers.<br />
            This form only sends your order to our Discord – staff will handle payment & delivery.
          </div>
        </div>

        <!-- Cart -->
        <div>
          <div class="cart-box">
            <div style="font-size:14px;font-weight:600;margin-bottom:6px;">Order Summary</div>
            <div id="cartItems"></div>
            <div class="cart-total-row">
              <span>Total:</span>
              <span id="cartTotal">€0.00</span>
            </div>
          </div>

          <button class="btn-primary" id="sendOrderBtn">
            Send Order to Discord
          </button>
          <div class="footer-note">
            All orders are processed manually by staff through Discord.
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ---- CONFIG ----
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1446616695098704044/sHiRFYAtXQG7PmTPefcZimDu5g60pKeG-sCNjfJfb2UdKOonYUV2uhMVS78hChXQIZp2";

    const products = [
      {
        id: "donut-money",
        name: "1m donut money",
        price: 0.05
      },
      {
        id: "skeleton",
        name: "1 skeleton",
        price: 0.10
      },
      {
        id: "elytra",
        name: "1 elytra",
        price: 10.0
      }
    ];

    // cart = { productId: { product, qty } }
    const cart = {};

    const productGrid = document.getElementById("productGrid");
    const cartItemsEl = document.getElementById("cartItems");
    const cartTotalEl = document.getElementById("cartTotal");
    const sendOrderBtn = document.getElementById("sendOrderBtn");

    // Render product cards
    function renderProducts() {
      products.forEach((p) => {
        const card = document.createElement("div");
        card.className = "product-card";

        const icon = document.createElement("div");
        icon.className = "product-icon";
        icon.textContent = "✨";

        const name = document.createElement("div");
        name.className = "product-name";
        name.textContent = p.name;

        const price = document.createElement("div");
        price.className = "product-price";
        price.textContent = `€${p.price.toFixed(2)}`;

        const btn = document.createElement("button");
        btn.className = "product-btn";
        btn.textContent = "Add to cart";
        btn.addEventListener("click", () => addToCart(p.id));

        card.appendChild(icon);
        card.appendChild(name);
        card.appendChild(price);
        card.appendChild(btn);

        productGrid.appendChild(card);
      });
    }

    function addToCart(productId) {
      const product = products.find((p) => p.id === productId);
      if (!product) return;

      if (!cart[productId]) {
        cart[productId] = { product, qty: 0 };
      }
      cart[productId].qty += 1;
      renderCart();
    }

    function changeQty(productId, delta) {
      if (!cart[productId]) return;
      cart[productId].qty += delta;
      if (cart[productId].qty <= 0) {
        delete cart[productId];
      }
      renderCart();
    }

    function renderCart() {
      cartItemsEl.innerHTML = "";

      const entries = Object.values(cart);
      if (entries.length === 0) {
        const empty = document.createElement("div");
        empty.className = "cart-empty";
        empty.textContent = "Cart is empty. Add some items!";
        cartItemsEl.appendChild(empty);
        cartTotalEl.textContent = "€0.00";
        return;
      }

      let total = 0;

      entries.forEach(({ product, qty }) => {
        const row = document.createElement("div");
        row.className = "cart-item";

        const left = document.createElement("div");
        const name = document.createElement("div");
        name.className = "cart-item-name";
        name.textContent = product.name;

        const price = document.createElement("div");
        price.className = "cart-price";
        price.textContent = `€${product.price.toFixed(2)} each`;

        left.appendChild(name);
        left.appendChild(price);

        const controls = document.createElement("div");
        controls.className = "cart-item-controls";

        const minus = document.createElement("button");
        minus.className = "cart-qty-btn";
        minus.textContent = "–";
        minus.addEventListener("click", () => changeQty(product.id, -1));

        const qtyEl = document.createElement("span");
        qtyEl.className = "cart-qty";
        qtyEl.textContent = qty;

        const plus = document.createElement("button");
        plus.className = "cart-qty-btn";
        plus.textContent = "+";
        plus.addEventListener("click", () => changeQty(product.id, 1));

        controls.appendChild(minus);
        controls.appendChild(qtyEl);
        controls.appendChild(plus);

        row.appendChild(left);
        row.appendChild(controls);
        cartItemsEl.appendChild(row);

        total += product.price * qty;
      });

      cartTotalEl.textContent = `€${total.toFixed(2)}`;
    }

    async function sendOrder() {
      const discord = document.getElementById("discord").value.trim();
      const minecraft = document.getElementById("minecraft").value.trim();
      const notes = document.getElementById("notes").value.trim();

      if (!discord || !minecraft) {
        alert("Discord and Minecraft username are required.");
        return;
      }

      const entries = Object.values(cart);
      if (entries.length === 0) {
        alert("Your cart is empty.");
        return;
      }

      let total = 0;
      const lines = entries.map(({ product, qty }) => {
        const lineTotal = product.price * qty;
        total += lineTotal;
        return `• ${product.name} x${qty} — €${lineTotal.toFixed(2)}`;
      });

      const message =
        "**New Donut Market Order**\n\n" +
        `**Discord:** ${discord}\n` +
        `**Minecraft:** ${minecraft}\n` +
        (notes ? `**Notes:** ${notes}\n` : "") +
        "\n**Items:**\n" +
        lines.join("\n") +
        `\n\n**Total:** €${total.toFixed(2)}`;

      sendOrderBtn.disabled = true;
      sendOrderBtn.textContent = "Sending...";

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content: message })
        });

        if (!res.ok) {
          throw new Error("Discord webhook error");
        }

        alert("Order sent to Discord! Staff will contact you there.");
        // clear cart
        for (const key in cart) delete cart[key];
        renderCart();
      } catch (err) {
        console.error(err);
        alert("Failed to send order. Check the webhook URL or try again later.");
      } finally {
        sendOrderBtn.disabled = false;
        sendOrderBtn.textContent = "Send Order to Discord";
      }
    }

    sendOrderBtn.addEventListener("click", sendOrder);

    // Init
    renderProducts();
    renderCart();
  </script>
</body>
</html>
